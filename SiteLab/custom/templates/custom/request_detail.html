{% extends 'main/base.html' %}
{% block title %}Request Details | SiteLab{% endblock %}

{% block content %}
<div class="container py-5 mt-5">
  <div class="glass-card p-5 shadow-lg rounded-4"
    style="background: rgba(255,255,255,0.85); backdrop-filter: blur(15px);">

    <!-- Project Title -->
    <h2 class="fw-bold mb-4 text-center">{{ req.project_title }}</h2>

    <!-- Project Info -->
    <div class="mb-4">
      <p><strong>Requirements:</strong><br>{{ req.requirements }}</p>

      {% if req.sample_links %}
      <p><strong>Sample Links:</strong><br>{{ req.sample_links }}</p>
      {% endif %}
    </div>

    <hr>

    <!-- Status Badge -->
    <div class="mb-4">
      <p><strong>Status:</strong>
        {% if req.status == 'pending' %}
        <span class="badge bg-primary fs-6">{{ req.get_status_display }}</span>
        {% elif req.status == 'in_progress' %}
        <span class="badge bg-info fs-6">{{ req.get_status_display }}</span>
        {% elif req.status == 'completed' %}
        <span class="badge bg-success fs-6">{{ req.get_status_display }}</span>
        {% elif req.status == 'rejected' %}
        <span class="badge bg-danger fs-6">{{ req.get_status_display }}</span>
        {% endif %}
      </p>
    </div>

    <!-- Payments -->
    <div class="mb-4">
      <p><strong>Deposit:</strong>
        {% if req.deposit_paid %}
        <span class="badge bg-success">Paid</span>
        {% else %}
        <span class="badge bg-danger">Not Paid</span>
        <a href="{% url 'custom:process_payment_view' req.pk %}?next={{ request.get_full_path }}" class="btn btn-sm btn-custom-primary ms-2">
          Pay Deposit
        </a>
        {% endif %}
      </p>

      <p><strong>Final Payment:</strong>
        {% if req.final_paid %}
        <span class="badge bg-success">Paid</span>
        {% else %}
        <span class="badge bg-danger">Not Paid</span>
        {% if req.deposit_paid %}
        <a href="{% url 'custom:process_payment_view' req.pk %}?next={{ request.get_full_path }}" class="btn btn-sm btn-custom-primary ms-2">
          Pay Final
        </a>
        {% endif %}
        {% endif %}
      </p>
    </div>

    <hr>

    {% if request.user.is_staff %}
    <hr>
    <div class="mb-3">
      <form method="POST" action="{% url 'custom:update_status' pk=req.pk %}">
        {% csrf_token %}
        <label class="form-label fw-bold">Update Status (Admin Only):</label>
        <select name="status" class="form-select w-auto d-inline-block me-2">
          <option value="pending" {% if req.status == 'pending' %}selected{% endif %}>Pending</option>
          <option value="in_progress" {% if req.status == 'in_progress' %}selected{% endif %}>In Progress</option>
          <option value="completed" {% if req.status == 'completed' %}selected{% endif %}>Completed</option>
          <option value="rejected" {% if req.status == 'rejected' %}selected{% endif %}>Rejected</option>
        </select>
        <button type="submit" class="btn btn-sm btn-warning">Update Status</button>
      </form>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="d-flex flex-wrap gap-2">

      <a href="{{ back_url }}" class="btn btn-secondary mb-3">
        <i class="fa-solid fa-arrow-left me-1"></i> Back
      </a>
      
      {% if req.status != 'completed' %}
      <a href="{% url 'custom:edit_request_view' req.pk %}?next={{ request.get_full_path }}" class="btn btn-outline-primary">
        <i class="fa-solid fa-pen me-1"></i> Edit Request
      </a>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}